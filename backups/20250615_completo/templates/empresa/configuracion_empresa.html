{% extends 'base.html' %}
{% load static %}

{% block title %}Configuración de Empresa{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/dental-theme.css' %}">
{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow-lg border-0 rounded-lg">
                <div class="card-header bg-dental-primary text-white">
                    <h3 class="text-center mb-0">
                        <i class="fas fa-cogs me-2"></i>
                        Configuración de Empresa
                    </h3>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <!-- Selector de Empresa -->
                        <div class="mb-4">
                            <label class="form-label text-dental-primary">
                                <i class="fas fa-building me-2"></i>
                                Empresa Actual
                            </label>
                            <select name="empresa" class="form-select form-select-lg" required>
                                {% for empresa in empresas %}
                                    <option value="{{ empresa.id }}" 
                                            {% if empresa.id == empresa_actual.id %}selected{% endif %}>
                                        {{ empresa.nombre_fantasia|default:empresa.razon_social }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Información de la Empresa -->
                        <div class="card mb-4 border-dental-primary">
                            <div class="card-header bg-dental-light">
                                <h5 class="mb-0 text-dental-primary">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Información de la Empresa
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Razón Social</label>
                                        <input type="text" class="form-control" value="{{ empresa_actual.razon_social }}" readonly>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Nombre de Fantasía</label>
                                        <input type="text" class="form-control" value="{{ empresa_actual.nombre_fantasia }}" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Logo de la Empresa -->
                        <div class="card mb-4 border-dental-primary">
                            <div class="card-header bg-dental-light">
                                <h5 class="mb-0 text-dental-primary">
                                    <i class="fas fa-image me-2"></i>
                                    Logo de la Empresa
                                </h5>
                            </div>
                            <div class="card-body">
                                <div class="text-center mb-3">
                                    {% if empresa_actual.logo %}
                                        <img src="{{ empresa_actual.logo.url }}" 
                                             alt="{{ empresa_actual.nombre_fantasia|default:empresa_actual.razon_social }}" 
                                             class="img-thumbnail rounded-circle" 
                                             style="max-width: 200px; height: 200px; object-fit: cover;">
                                    {% else %}
                                        <div class="rounded-circle bg-dental-secondary text-white d-flex align-items-center justify-content-center mx-auto" 
                                             style="width: 200px; height: 200px;">
                                            <i class="fas fa-building fa-4x"></i>
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-dental-primary btn-lg">
                                <i class="fas fa-save me-2"></i>
                                Guardar Cambios
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.border-dental-primary {
    border-color: var(--dental-primary) !important;
}

.bg-dental-light {
    background-color: var(--dental-light) !important;
}

.text-dental-primary {
    color: var(--dental-primary) !important;
}

.btn-dental-primary {
    background-color: var(--dental-primary);
    border-color: var(--dental-primary);
    color: white;
    transition: all 0.3s ease;
}

.btn-dental-primary:hover {
    background-color: var(--dental-secondary);
    border-color: var(--dental-secondary);
    transform: translateY(-2px);
    box-shadow: 0 4px 15px rgba(0, 160, 176, 0.2);
}

.form-select:focus, .form-control:focus {
    border-color: var(--dental-primary);
    box-shadow: 0 0 0 0.25rem rgba(0, 160, 176, 0.25);
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Vista previa del logo
    const logoInput = document.querySelector('input[type="file"]');
    const logoPreview = document.getElementById('logo-preview');
    const logoPlaceholder = document.getElementById('logo-placeholder');
    
    if (logoInput) {
        logoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logoPreview.src = e.target.result;
                    logoPreview.classList.remove('d-none');
                    logoPlaceholder.classList.add('d-none');
                }
                reader.readAsDataURL(file);
            }
        });
    }

    // Eliminar logo
    const removeLogoBtn = document.getElementById('remove-logo');
    if (removeLogoBtn) {
        removeLogoBtn.addEventListener('click', function() {
            logoPreview.classList.add('d-none');
            logoPlaceholder.classList.remove('d-none');
            logoInput.value = '';
        });
    }
});
</script>
{% endblock %} 